import{useState as n,useEffect as t,useLayoutEffect as e,useRef as r}from"react";const o=function(){function n(){}return n.prototype.then=function(t,e){const r=new n,o=this.s;if(o){const n=1&o?t:e;if(n){try{i(r,1,n(this.v))}catch(n){i(r,2,n)}return r}return this}return this.o=function(n){try{const o=n.v;1&n.s?i(r,1,t?t(o):o):e?i(r,1,e(o)):i(r,2,o)}catch(n){i(r,2,n)}},r},n}();function i(n,t,e){if(!n.s){if(e instanceof o){if(!e.s)return void(e.o=i.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(i.bind(null,n,t),i.bind(null,n,2));n.s=t,n.v=e;const r=n.o;r&&r(n)}}function u(n){return n instanceof o&&1&n.s}const l={};!function(){function n(n){this._entry=n,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function t(n){return{value:n,done:!0}}function e(n){return{value:n,done:!1}}n.prototype[Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))]=function(){return this},n.prototype._yield=function(n){return this._resolve(n&&n.then?n.then(e):e(n)),this._pact=new o},n.prototype.next=function(n){const e=this;return e._promise=new Promise(function(r){const u=e._pact;if(null===u){const n=e._entry;if(null===n)return r(e._promise);function c(n){e._resolve(n&&n.then?n.then(t):t(n)),e._pact=null,e._resolve=null}e._entry=null,e._resolve=r,n(e).then(c,function(n){if(n===l)c(e._return);else{const t=new o;e._resolve(t),e._pact=null,e._resolve=null,_resolve(t,2,n)}})}else e._pact=null,e._resolve=r,i(u,1,n)})},n.prototype.return=function(n){const e=this;return e._promise=new Promise(function(r){const o=e._pact;if(null===o)return null===e._entry?r(e._promise):(e._entry=null,r(n&&n.then?n.then(t):t(n)));e._return=n,e._resolve=r,e._pact=null,i(o,2,l)})},n.prototype.throw=function(n){const t=this;return t._promise=new Promise(function(e,r){const o=t._pact;if(null===o)return null===t._entry?e(t._promise):(t._entry=null,r(n));t._resolve=e,t._pact=null,i(o,2,n)})}}();export default function(l,c){void 0===c&&(c={});var s=n({data:null,loading:0,error:null,controller:null}),a=s[0],f=s[1],h=r(!1);return e(function(){return h.current=!0,function(){h.current=!1}},[]),t(function(){var n=new AbortController;return l&&(f(function(t){return{data:null,loading:t.loading+1,error:null,controller:n}}),function(t,e,r,l){var c=Object.assign({},e,{signal:n.signal});fetch(t,c).then(function(n){return n.ok?Promise.resolve(n):Promise.reject({message:n.statusText,status:n.status})}).then(function(n){if(!e.streaming)return n;if(!n.body)throw new Error("Invalid response body");var t=n.body.getReader();!function(){try{var n=!1,e=function(n,t,e){for(var r;;){var l=n();if(u(l)&&(l=l.v),!l)return c;if(l.then){r=0;break}var c=e();if(c&&c.then){if(!u(c)){r=1;break}c=c.s}if(t){var s=t();if(s&&s.then&&!u(s)){r=2;break}}}var a=new o,f=i.bind(null,a,2);return(0===r?l.then(v):1===r?c.then(h):s.then(d)).then(void 0,f),a;function h(r){c=r;do{if(t&&(s=t())&&s.then&&!u(s))return void s.then(d).then(void 0,f);if(!(l=n())||u(l)&&!l.v)return void i(a,1,c);if(l.then)return void l.then(v).then(void 0,f);u(c=e())&&(c=c.v)}while(!c||!c.then);c.then(h).then(void 0,f)}function v(n){n?(c=e())&&c.then?c.then(h).then(void 0,f):h(c):i(a,1,c)}function d(){(l=n())?l.then?l.then(v).then(void 0,f):v(l):i(a,1,c)}}(function(){return!n},void 0,function(){return Promise.resolve(t.read()).then(function(t){var e=t.value;t.done?n=!0:l(function(n){var t,r,o,i=n.data?n.data:new Int8Array;return Object.assign({},n,{data:(t=i,r=e,o=new Uint8Array(t.byteLength+r.byteLength),o.set(new Uint8Array(t),0),o.set(new Uint8Array(r),t.byteLength),o)})})})});Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(n){return Promise.reject(n)}}()}).then(function(n){l(function(t){return Object.assign({},t,{data:n||null,loading:t.loading-1})})}).catch(function(n){var t="AbortError"!==n.name?n:null;l(function(n){return Object.assign({},n,{error:t,loading:n.loading-1})})})}(l,c,0,function(n){h.current&&f(n)})),function(){return n.abort()}},[l]),{data:a.data,loading:!!a.loading,error:a.error,abort:function(){return a.controller&&a.controller.abort()}}}
//# sourceMappingURL=index.mjs.map
